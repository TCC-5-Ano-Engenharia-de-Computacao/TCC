<?xml version="1.0" encoding="UTF-8"?>
<StateMachine initialState="idle">

    <States>

        <!-- IDLE  -->
        <State id="idle">

            <!-- ao entrar: põe animação, ajusta gravidade normal -->
            <OnEnter>
<!--                <SetAnimationAction path="Sprites/PlayerIdle" frames="8"/>-->
<!--                <SetPlayerGravityAction scale="1"/>-->
                <LogAction msg="Entering idle"/>
            </OnEnter>

            <!-- enquanto permanecer: movimento lateral contínuo -->
            <OnStay>
                <LogAction msg="Idle stay"/>
<!--                <MovePlayerAction speed="5" direction="right"/>-->
            </OnStay>

            <!-- ao sair: só loga -->
            <OnLeave>
                <LogAction msg="Leaving idle"/>
            </OnLeave>

            <!-- transita para “jump” assim que começar a cair -->
            <Transitions>
                <Transition to="jump">
                    <Conditions>
                        <AnalogHistoryRegexCondition regexString="8$"/> <!--REGEX EXEMPLO: "^(.*[^8])?8{3,7}$"-->
                    </Conditions>
                </Transition>
                <Transition to="moveRight">
                    <Conditions>
                        <AnalogHistoryRegexCondition regexString="6$"/>
                    </Conditions>
                </Transition>
            </Transitions>
        </State>

        <!-- JUMP -->
        <State id="jump">

            <BeforeEnter>
                <LogAction msg="BeforeEntering jump"/>
                <ClearAnalogHistoryAction/>
            </BeforeEnter>
            
            <!-- ao entrar: toca animação de pulo, aplica impulso e som -->
            <OnEnter>
<!--                <SetAnimationAction path="Sprites/PlayerJump" frames="4"/>-->
<!--                <JumpPlayerAction force="8"/>-->
<!--                <MakeSoundAction path="Sounds/jump" volume="0.8"/>-->
                <LogAction msg="Entering jump"/>
            </OnEnter>

            <!-- opcional: logs enquanto estiver no ar -->
            <OnStay>
                <LogAction msg="In air"/>
            </OnStay>

            <!-- volta para idle quando tocar o chão -->
            <Transitions>
                <Transition to="idle">
                    <Conditions>
                        <AlwaysFalseCondition/>
                    </Conditions>
                </Transition>
                <Transition to="moveRight">
                    <Conditions>
                        <AnalogHistoryRegexCondition regexString="6$"/>
                    </Conditions>
                </Transition>
            </Transitions>
            
        </State>
        
        <!-- MoveRight -->
        <State id="moveRight">
            <BeforeEnter>
                <LogAction msg="BeforeEntering moveRight"/>
                <ClearAnalogHistoryAction/>
            </BeforeEnter>
            
            <OnEnter>
                <LogAction msg="Entering moveRight"/>
            </OnEnter>
            
            <OnStay>
                <LogAction msg="Moving right"/>
            </OnStay>
            
            <Transitions>
                <Transition to="idle">
                    <Conditions>
                        <AnalogHistoryRegexCondition regexString="5$"/>
                    </Conditions>
                </Transition>
                <Transition to="jump">
                    <Conditions>
                        <AnalogHistoryRegexCondition regexString="8$"/> <!--REGEX EXEMPLO: "^(.*[^8])?8{3,7}$"-->
                    </Conditions>
                </Transition>
            </Transitions>
        </State>

    </States>
</StateMachine>